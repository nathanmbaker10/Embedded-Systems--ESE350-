/*
 * _440Hz_SineWave.c
 *
 * Created: 3/28/2021 4:44:34 PM
 *  Author: Nathan Baker
 */ 


 #include <avr/io.h>
 #include <avr/interrupt.h>
 #define F_CPU 16000000UL
 #include <util/delay.h>
 #include <stdio.h>
 #include "UART.h"
 
 volatile int count = 0;
 int table[] = {0x47,0x4d,0x53,0x59,0x5f,0x65,0x6b,0x70,0x75,0x79,0x7e,0x81,0x85,0x87,0x8a,0x8b,0x8c,0x8d,0x8d,0x8c,0x8b,0x8a,0x87,0x85,0x81,0x7e,0x79,0x75,0x70,0x6b,0x65,0x5f,0x59,0x53,0x4d,0x47,0x40,0x3a,0x34,0x2e,
	 0x28,0x22,0x1d,0x18,0x14,0xf,0xc,0x8,0x6,0x3,0x2,0x1,0x0,0x0,0x1,0x2,0x3,0x6,0x8,0xc,0xf,0x14,0x18,0x1d,0x22,0x28,0x2e,0x34,0x3a,0x40,0x47};
 
 
 ISR(TIMER0_COMPA_vect) {
	 if(count < 70) {
		OCR0B = table[count];
		count++;	 
	 } else {
		count = 0;
	 }
 }
 
 void Initialize() {
	cli();
	DDRD |= (1<<DDD5); //PD5 (OC0B configured to output)
	//Prescale timer 0 by 256 (62.5Khz)
	TCCR0B |= (1<<CS02);
	TCCR0B &= ~(1<<CS01);
	TCCR0B &= ~(1<<CS00);
	
	//Toggle OC0B on compare match
	TCCR0A = 0;
	TCCR0A |= (1<<COM0B1);
	TCCR0A &= ~(1<<COM0B0); 
	
	//FastPWM mode with OCR0A as TOP
	TCCR0B |= (1<<WGM02);
	TCCR0A |= (1<<WGM01);
	TCCR0A |= (1<<WGM00);
	
	//Compare match overflow vector enabled
	TIMSK0 |= (1<<OCIE0A);
	
	OCR0A = 141;
	OCR0B = 0x47;
	sei();
 }
 
 
 int main(void) {
	 Initialize();
	 while(1);
 }